# js基础

## 什么是闭包,闭包的作用
闭包是计算机科学中的一个概念，它指的是一个函数，该函数可以访问并操作在其外部作用域中定义的变量，即使该外部函数已经结束执行。闭包通常是通过在一个函数内部定义另一个函数来实现的，这个内部函数可以访问外部函数的局部变量。

闭包的作用主要包括：

避免全局变量污染。闭包可以保护外部作用域中的变量不被其他代码意外修改
保持变量在内存中。由于闭包内部可以访问外部函数的变量，这些变量的值不会在外部函数执行完毕后被自动清除，从而延长了它们在内存中的生命周期。
实现特定功能。闭包可以用于设计模式，如单例模式，或者用于其他需要维护变量状态的场景。
然而，闭包也可能导致内存泄漏的问题，因为它使得某些变量持续存在于内存中，即使它们不再需要。

## 虚拟dom是什么？原理？优缺点？

1. 虚拟DOM本质上是JavaScript对象,是对真实DOM的抽象 状态变更时，记录新树和旧树的差异
   最后把差异更新到真正的dom中.
   虚拟DOM的作用：使用原生js或者jquery写页面的时候会发现操作DOM是一件非常麻烦的一件事情，往往是DOM标签
   和js逻辑同时写在js文件里，数据交互时不时还要写很多的input隐藏域，如果没有好的代码规范的话会显得代码非常冗
   余混乱，耦合性高并且难以维护。
   另外一方面在浏览器里一遍又一遍的渲染DOM是非常非常消耗性能的，常常会出现页面卡死的情况；所以尽量减少对
   DOM的操作成为了优化前端性能的必要手段，vdom就是将DOM的对比放在了js层，通过对比不同之处来选择新渲染
   DOM节点，从而提高渲染效率。

2. patch函数
   patch函数的执行分为两个阶段，两次传递的参数都是两个

- 第一阶段为虚拟dom的第一次渲染，传递的两个参数分别是放真实DOM的container和生成的vnode，此时patch函数的作用是用来将初次生成的真实DOM结构挂载到指定的container上面。

- 第二阶段传递的两个参数分别为vnode和newVnode，此时patch函数的作用是使用diff算法对比两个参数的差异，进而更新参数变化的DOM节点；

  可以发发现h函数和patch函数在cnabbdom中实现vdom到真实DOM的转化起到了至关重要的作用，那么还有一个很重要的环节，patch函数中是怎么样实现对比两个vnode从而实现对真实DOM的更新的呢，这里还要提一下snabbdom的另外一个核心算法，即diff算法。

3. diff算法
其实在我们日常开发中我们都在接触类似与diff算法的一些软件，比如svn可以看到当前代码和svn服务器上代码的不同之处，再如Beyond Compare这款软件也可以为我们指出两个对比文件的不同之处

### 虚拟DOM的优缺点：

- 优点：
  保证性能下限: 虚拟DOM可以经过diff找出最小差异,然后批量进行patch,这种操作虽然比不上手动优化,但是比起粗暴的DOM操作性能要好很多,因此虚拟DOM可以保证性能下限
  无需手动操作DOM: 虚拟DOM的diff和patch都是在一次更新中自动进行的,我们无需手动操作DOM,极大提高开发效率
  跨平台: 虚拟DOM本质上是JavaScript对象,而DOM与平台强相关,相比之下虚拟DOM可以进行更方便地跨平台操作,例如服务器渲染、移动端开发等等
- 缺点：
  无法进行极致优化: 在一些性能要求极高的应用中虚拟DOM无法进行针对性的极致优化，比如VScode采用直接手动操作DOM的方式进行极端的性能优化